<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/blog.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/blog.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/yqq/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":true},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="NeRF代码(基于Pytorch)。流程图：train流程图 and 渲染流程图 (基于Drawio)">
<meta property="og:type" content="article">
<meta property="og:title" content="NeRF代码理解">
<meta property="og:url" content="http://example.com/3DReconstruction/Multi-view/Implicit%20Function/NeRF-based/NeRF%20Other%20Research/NeRF-code/index.html">
<meta property="og:site_name" content="QiYun">
<meta property="og:description" content="NeRF代码(基于Pytorch)。流程图：train流程图 and 渲染流程图 (基于Drawio)">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/yq010105/Blog_images/main/pictures/20230618145142.png">
<meta property="article:published_time" content="2023-06-15T06:50:33.000Z">
<meta property="article:modified_time" content="2024-06-29T12:16:37.018Z">
<meta property="article:author" content="Qi Yun">
<meta property="article:tag" content="NeRF">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Code">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/yq010105/Blog_images/main/pictures/20230618145142.png">

<link rel="canonical" href="http://example.com/3DReconstruction/Multi-view/Implicit%20Function/NeRF-based/NeRF%20Other%20Research/NeRF-code/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>NeRF代码理解 | QiYun</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">QiYun</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Note</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/3DReconstruction/Multi-view/Implicit%20Function/NeRF-based/NeRF%20Other%20Research/NeRF-code/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Qi Yun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QiYun">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          NeRF代码理解
        </h1>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-06-15 14:50:33" itemprop="dateCreated datePublished" datetime="2023-06-15T14:50:33+08:00">2023-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-06-29 20:16:37" itemprop="dateModified" datetime="2024-06-29T20:16:37+08:00">2024-06-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/3DReconstruction-Multi-view-Implicit-Function/" itemprop="url" rel="index"><span itemprop="name">3DReconstruction/Multi-view/Implicit Function</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>2.1k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>8 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><a target="_blank" rel="noopener" href="https://github.com/yenchenlin/nerf-pytorch">NeRF代码</a>(基于Pytorch)。流程图：<a href="#train流程">train流程图</a> and <a href="#渲染流程图">渲染流程图</a> (基于Drawio)</p>
<span id="more"></span>
<h1 id="train流程"><a href="#train流程" class="headerlink" title="train流程"></a>train流程</h1><iframe frameborder="0" style="width:100%;height:1724px;" src="https://viewer.diagrams.net/?highlight=0000ff&edit=_blank&layers=1&nav=1&title=train%E6%B5%81%E7%A8%8B.drawio#R7V1bk6O4Ff41rkoe4gKJ6%2BP0TM%2Fmsj1JZVJJ9sklG9kmDYgVcru9vz6SARss2aOYxoIUVVM9Rki2ONJ37jrM4Of0%2FSeK8u0LiXAyA1b0PoNfZgBA13f5f6LlULbYrmeVLRsaR1XbueF7%2FBuuGutuuzjCRasjIyRhcd5uXJEswyvWakOUkn2725ok7V%2FN0QZLDd9XKJFb%2FxVHbFu2BsA%2Ft%2F8Rx5tt%2Fcu2F5Z3UlR3rp6k2KKI7BtN8HkGP1NCWPkpff%2BME0G9mi7luK9X7p4mRnHGdAZ8%2B4ePf8qfQ7b6y28L9mf89PLPT3%2BoJluwQ%2F3AOOLPX10SyrZkQzKUPJ9bnyjZZREW32rxq3OfnwnJeaPNG%2F%2BDGTtUi4l2jPCmLUuT6i5%2Bj9m%2FxfC5W1390rjz5b365uPFob7IGD00BonLX5r3zsOOV%2FW4NclYNRHb49fl84qHvErGqqkgO7rCN2hXb0dEN5jd6AdOi81hgkmK%2Bfz4OIoTxOK39jxQtV03p37nFeUfqkX9Hxa4%2Bt43lOyqX2IUxdnvfi8t%2FHlZxUrstzHD33N0pMCeg7u9hGqyvmHK8PttwsqEqAc4YF6zi4pbBBV09mfk2TVj2DZQ51p9Uc%2BSyDThQxcfQBMf0CQ%2BgIQPLknW8WbBn7jA9CZOLDM4gf4lTmxPARSgAIrXG1CCCSh3AwVqAsW%2BsjEegxQoISUhKFrM4Nfy3yJCDI0DLyeBYQwvRuFiN8Byho4aLj1ue0dz2%2Fsmd72j3vXLBPO1oEPd89Cy5xpb3lNsedjXlvckSkpk4yZSLj6udjQ5PFG0ehUb40f0ayuuPVAT%2BJJmerLqGuRUMZATV%2FlwcvoSOXNS4EWRbzGNuf06wF3pBMPblTYcCyc%2BKy4tteWsxRiwgHVNYNszycNPzzMpp32ucWhyjW3Z0bGiGDG8yDBdD5AZKtRS6JtWS213Qsr9SNF1eNiOUaTILo9v%2BO9fBwgRaEkQcaCrB5HeFAYwuQQ7QETX5jMsTGSrL8NsT%2Bjr4tcdpofFOuN3jzcsussW1c0BQgiEkuniqLzq7kO96v4Eofsh5OlCCBiFkGzu8%2BkucLrEUTRIv7pC2sDAuLQZoXk6HKiEmlABRqECZUfYxA4%2FfI2h0eBJPc0GO4zX4ofoppjT0pdMsoQT7NMMeCgV7C5bFvmJWE1GuSXpclcYYZKh02KQriMzSMD5qCuzyKA3FjlpE%2FfDB%2BjarMA1CZ96mg34VKDJEdsOUZkAkt7tAePKhGzWHHAh0Y4%2FNWsTqGCUvOLPJCGUt2QkExBax0ly0YSSeJPxyxWnEubtT4KGIhjxqbqRxlF0xJ9qRdpr1seiQGlR3FA2hhzFmvQWxgGjSZzokwu5ulzIbBzBvcKFBAP6kdAeIENSOQIeypCgUV%2FayINvQNcRAIz60oDsCGAkWI5DZvvQNESAbDhc8po0TveUE0vsBSK6xhEmg6OuIydR%2BLoakdMbAzIT7%2FogO%2BAeKf6BDCjQzVuEXeNd1dC%2FkZjP8ezbtqzLHRXaFzulfIhq4MVmOc2kQxqfMxbtbYC2J9TNLAiMZojX07zwZFN0KBZZPgLVT5FpoM15e8s0gHI6cSYLrf9bU9R2ZXVcoWs81BSFo0lKHqA2DnUj29BoOnN9OnESWH2usRcYFViym%2B%2Fsphi%2BbAp1DzP1lp%2FgTPmiHUDia4LEsdQ7o6NVAAOvtZ1s61JgljPrzSaAcmZ%2BrS8OEIAQtMkV6uag9ubxcCab6n701Qrjj9Fn1Kaqp9nU%2FqPVCSOlHytJ1uvB48W2jLsIXaPiauR6u6PrxHKMBsA9b2KK%2Fa%2BxZ3SNHdklskRstY3Xh7FoD7ZlPKboTkjpgBTdQLxj9lD2tUD8UHHiSEaJeZxM3r4OONE2co3G3r3JlHrAGntdHRndeKHsbhj2kSSJF9owNM0Lp2OvHXCim4HvGj32Wk9ToV0PECTepWJtHiQemEByN0hc7dDRh3jFP1GuCDc65MLZXTS%2B%2BcJp7l3yZOBfFBO9GOA6twfwD%2BUcPtS17sqRrcZJ3PqIbqMpLQvSDh3cwNK0BnpLhPOMnjMcObg9Xae7Z%2FQMmic73SnaA7Jj%2BY6NwmoGitMaDxaC02GzDjjRTfjr7Ie9SwhKMg0Gt4WgFGq%2BGNCPEKyp2IBxgdI8wYs8GmKhIwnF0DGN4jrGPaH4HhTr%2BojNZkF5so%2BYEbrazleIDQ4jUhzF0dUI%2B8PIdDCx3sI6NWqN%2BjbqaTb2OkqSBcVCWIlcCi8RadRLyj9txCd%2BZ5HEhbg9A0%2Fir3tsi%2BIVm7lfBocPG7hz0E4TtB1VppKjqDzQW56gL0viY3FgkbgyosrAtoKOD63B6gM1HX%2F%2B07fnl79%2BGREpVfbJY0l5pUp79DYeKkJVRtVDqRgY1Q9HHhv1teu6G80hCCZ39gPWODDq8fJV1fuLYla7h%2BN0A9ICD5ArqhQeV2U3P1bhkW2qYxWrYyBNDBaed7bFFEsEZTRG2ebqgbt%2BqelC6c1SKqWnDrE9pGyVbRlNzriztB8YDAfSzc4Iu0qZ%2B3yJtXFyAm%2Flj7gaULsc4F%2B%2Bzu8yZBfeHtCP89GXs004AwV5kQ3xdBkE8quyzHPRYDSelQFqHoF20QCz2qXsGqi9MFH8VrthhDIyX6LV6x7R6FhJ4NiD%2F2Kjk2IcyVmccvrSecFwfn3gwOCoUmo8lSB%2BLBxlk7l5Xm98xR0C3SN8vWUT2JbZhLr7dJvBsDjdAIvZuiiBbAy8oKMFcFyw60CxjQAFeHL9KVV574e%2BXzac0m464ETXBAiMJuEHssqsEOkZ3i8Sik5V3DQ1gV0elWNOKsGYdQHVoZiH6gLhCG3yFhpNOn4D3UTw0KhTsJ7mbTwW6E3AarXFq9e8tLw1Ickfnw9cx3xvjBeKvurFjI%2BFotFznCOHYqhrJYdGTzyHWlZyLoSaFS%2BquqaWsHmLSkxajeKn1f1RYA6EsmdqAJibzoR2wJyu2dbZI91tjWWz7QbmGC5YcUwjaqGuPG0trvAxiShO0Ua8SWAU2FNUIlZjT5Vz0N9L0SyjSQdtW9DSBF%2FbFrQNgk87HGTUFgy1bMEafDktIz4t6LFfo3ReibxRwM1zwkHCzWjVpI%2BAm0HXS6hr6nV2Ud4VfT2V7T8dOfBuB1P9Oghw74DAud3frlUrdf9%2BgrWhlqW7ScgSJQvBZGZlOrDoKeAxWvbi9che%2BCUlhDVXij%2Fm9uV40hQ%2B%2Fxc%3D"></iframe>



<h2 id="if-use-batching"><a href="#if-use-batching" class="headerlink" title="if use_batching"></a>if use_batching</h2><iframe frameborder="0" style="width:100%;height:1113px;" src="https://viewer.diagrams.net/?highlight=0000ff&edit=_blank&layers=1&nav=1&title=train_batch.drawio#R7Vxbb6M4GP01SO1DK%2B6Qx5CkU612q5VmdjvzFJHgADsEZ4C0yf76tcHmZichbQmwjTSagm3AnO%2Fq7zgIymS9%2BxLZG%2B8P6IBAkEVnJyhTQZYlTZPRH9yyz1pMSc8a3Mh3yKCi4av%2FLyCNImnd%2Bg6IKwMTCIPE31QblzAMwTKptNlRBF%2Brw1YwqD51Y7uAafi6tAO29dl3Eo%2B8hWwU7Y%2FAdz36ZEkfZT1rmw4mbxJ7tgNfS03KTFAmEYRJdrTeTUCAwaO4ZNc9HOjNJxaBMGlygbN2539%2Fc9X5t%2BeV%2BO3fx1dt8nynZXd5sYMteWEy2WRPEXAjuN0IirWCYULkI5nonH0%2BmdILiBKw40nHXtCbFgAgzQFwDZJoj8aRqxSRYEaUxiDTfC0kIBlkiFdGnzbaROpufusCGHRAsDkDJ%2Bk0Tq%2Ben4CvG3uJz1%2BRNSCMvGQdYLzQoR1vMv1c%2BTvgNMLzqMTqILNg7imYLHgqDzy1LfDkAYJHe6uKKHeOpTJcLOUqllLnWKoMlo%2B7550yGEC7t2y9l%2BFj1LfoYfTGaPUDGPc4epgDBK%2Bv0WM0XCx7Fz3oDGrhQx0Mot2btsRLq%2FUAPdeKN3ZYgVH%2FtcUrJWsJAxgJyhh1Ru7iBk0N%2FUOPF0tHt%2FgQAydiLO9W9toP9tk16Eb2epN2KoqKJQGCF5D4S5vpqd4kTiWCbyGZm12tL5sl7gxhtLaDavcrARP3q9k8084AJAmI7tCrLv3Q5V6PRJnc2YHvhln3EukAiKrdfuikmoH7xdLU0s4kssN4hW5Kbx%2BCfMArjJzq08uXL%2BzlTxy8Q%2BeuhrmsmjnWsjoqjrUS8o4fbwKboO6HgV968CqAdlKeEBUuOnLx3yck8hSpTBmQcmX6kPUyFobfFLWfMLS3ZyCHHbyiVbwSz6RkjTUppTWLYrNX4LjgKzmFUeJBF4Z2MCtarVTI2PVMsXyKMb9DuCHY%2FYNUdU%2FAs7cJrCILdn7yvXT8A9%2FqXiNn0x25c3qypychet%2Fv5ZPSVfi0uCw9o9c1lmIMt9ESNHDgiR254JhnJS4dA3lUKSIQ2In%2FUq0cfbyI2WXL1WleneZwnKai9s1pml06TeoZz3OahZ%2F8UXGTrTtNvaHTlLReeU1N7FLGbwuM75NxjESUjDEFglpSj0HaHnwM3VS8jB6oZq%2F0QGJLVtsYzBd2svSwR68rSeTB9WIbd%2BIoZbNWPzBYTynzVmxma57S6NRT5pbzo9TTV0%2BpNnWUer8MhK0R7UF8KHsoSSlOIvgTTLKshzqcFfI1tSaSmE1JVqZY2CBQKhmMScfad5xUcXgWV1WmNoxOqRndiDU6ns3JbdmcfM33r%2Fn%2BkPN9tWpQitZ1vi833vXQ%2BOXP5qhqoV3ROaFdNO45sOSl74%2FHpT%2Fksvwh2xxMjp%2BWWkuOKFrDgq85VXVhNPuz5eZ8NBuQVZdFU2JdXmTv4zmKVDR%2BLCIaOm4iKMhW5OD%2F3MXtrtNdEW8AP3eb3eFNeYHrQun0Qol67pMrJaVfhXg6717b1PmUVpF1EO%2Bli527L%2BVKFF%2FXQLw1kD9H8%2FbD9IIphnwA66E6aazzkq2LLogUNrXqabSqi%2BOt0evt0YpmUqejlfjR0Ypc%2Bif00aRzddJFvjbRO2QTJRfVFCWfxTs20R7fcUCKfoNObSpMCkQxSKgyKXgWjh176ftJ78uFmlaNVblfuRBbpLxBvhinObe709kQO2IguZHZ%2FUJZabAJuwfYyWoT7HiV9fZ%2BS9FgXzYIHWr5iwAuf9a8UuiU2NT8F17cSPUGur%2BJ43mHr2lKPJXko3HkQ9veGceUWtHE1Gtyz16ICWTsjWoFZ7OuQC1HRF0fSjY1jK0Gitk04xr1Kyayv1yw8DYDdPg0R6stJ1vYWLsbNMqSbjn1gP8vyzqS69GAQwvlK56LEK1UfUrySreFzHFVJ19hyjsLC6qer2TKOS%2FGWZ9bnCNOzZsrzvZ%2B3Sez0X2mC%2BMHwXwQZqpgmcJ4DDYQGeRME0aiYM5ib7taIRSzXpSxkQPriZYZagItgJW6KSXI9aRKEjlMIvdnHa0lpBpbrAvh57EFrW8bSLRPt2mr3XxEbZqPaP3iK1Q2HyGvwESz3rITGrMCV7TOyT76jZP3sROEmiC8BJ%2BUKDiIg3zDMbLhMNNwimY4xjEcJhiOswtHqIUmvEJOKuSMwkE6gcslpCRCjU4ombTor20XxIJmhZt7nK3D9f3Sg%2F4S3BDS4VbQpgfJhsKirsK%2FmPDr4jyUdFw%2BUdNrxQ2FU%2FvK94BdJD3W2Iptyl6jTG2SHjiDDgs9IK21BtsMB4OdfNGMdRglbc0Qe4ZbJ9%2FKePcKyeDs3bwobtTx9hw3naFQDF6V5aLIdbJL83zkdAY57obrSyLH%2B1lHfZneKvl0dCneLvVE1aYn1JOhKffGAcs6l30y6s7twvsxdE7WMRsJo3Fa9tSF0USwxrgF5T3mCJc%2BUftIJ4yELOalUSxaZJEBmwbSPFHMkvL8UrwljFMap9nkgeGfpS5o1JYAOqcuyK2Qa625oE6%2BS3a%2B8659zy3ncztz3WyaxSOKiIqfMo8Kc3Q1EOHo%2FpDWDGQ33f71FHm%2F1o%2BKJv4mBbH3hf%2FV10x8%2BPUFXmmnXpXR8UbZel0iBNFqHu%2FDxMP1nKIQg5yxNRHG6cHIEqyZMDOwkzYN6pXRkyZSaWRGS%2BXDi2pUNsHjZZCOVeiAfnC06KDKqLUVGOdTj4qscH9Fd77OoNPia81ZuC6%2Bea3M%2FgM%3D"></iframe>

<h1 id="config-parser"><a href="#config-parser" class="headerlink" title="config_parser()"></a>config_parser()</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">def config_parser():</span><br><span class="line">    import configargparse</span><br><span class="line">    parser = configargparse.ArgumentParser()</span><br><span class="line">    # 此处命令行更改的参数为 args.config</span><br><span class="line">    parser.add_argument(&#x27;--config&#x27;, is_config_file=True,</span><br><span class="line">                        help=&#x27;config file path&#x27;)</span><br><span class="line">    parser.add_argument(&quot;--expname&quot;, type=str,</span><br><span class="line">                        help=&#x27;experiment name&#x27;)</span><br><span class="line">    parser.add_argument(&quot;--basedir&quot;, type=str, default=&#x27;./logs/&#x27;,</span><br><span class="line">                        help=&#x27;where to store ckpts and logs&#x27;)</span><br><span class="line">    parser.add_argument(&quot;--datadir&quot;, type=str, default=&#x27;./data/llff/fern&#x27;,</span><br><span class="line">                        help=&#x27;input data directory&#x27;)</span><br><span class="line">    # training options</span><br><span class="line">    parser.add_argument(&quot;--netdepth&quot;, type=int, default=8,</span><br><span class="line">                        help=&#x27;layers in network&#x27;)</span><br><span class="line">    parser.add_argument(&quot;--netwidth&quot;, type=int, default=256,</span><br><span class="line">                        help=&#x27;channels per layer&#x27;)</span><br><span class="line">    parser.add_argument(&quot;--lrate&quot;, type=float, default=5e-4,</span><br><span class="line">                        help=&#x27;learning rate&#x27;)</span><br><span class="line">    parser.add_argument(&quot;--no_batching&quot;, action=&#x27;store_true&#x27;,</span><br><span class="line">                        help=&#x27;only take random rays from 1 image at a time&#x27;)</span><br><span class="line">    parser.add_argument(&quot;--no_reload&quot;, action=&#x27;store_true&#x27;,</span><br><span class="line">                        help=&#x27;do not reload weights from saved ckpt&#x27;)</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    return parser</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">use：    </span><br><span class="line">parser = config_parser()</span><br><span class="line">args = parser.parse_args()</span><br><span class="line">basedir = args.basedir</span><br></pre></td></tr></table></figure>
<h1 id="load-data"><a href="#load-data" class="headerlink" title="load_???_data()"></a>load_???_data()</h1><h2 id="load-llff-data"><a href="#load-llff-data" class="headerlink" title="load_llff_data()"></a>load_llff_data()</h2><p>输入：</p>
<ul>
<li>args.datadir ：’./data/llff/fern’</li>
<li>args.factor,</li>
<li>recenter=True, </li>
<li>bd_factor=.75,</li>
<li>spherify=args.spherify</li>
<li>path_zflat=False</li>
</ul>
<p>输出：</p>
<h2 id="load-blender-data-basedir-half-res-False-testskip-1"><a href="#load-blender-data-basedir-half-res-False-testskip-1" class="headerlink" title="load_blender_data(basedir, half_res=False, testskip=1)"></a>load_blender_data(basedir, half_res=False, testskip=1)</h2><p>输入：</p>
<ul>
<li>basedir，数据集路径’E:\\3\\Work\dataset\\nerf_synthetic\\chair’<blockquote>
<p>[!info]- chair 文件夹</p>
<ul>
<li>chair：<ul>
<li>test<ul>
<li>200张png 800x800x4</li>
</ul>
</li>
<li>train<ul>
<li>100张png</li>
</ul>
</li>
<li>val<ul>
<li>100张png</li>
</ul>
</li>
<li>.DS_Store</li>
<li>transforms_test.json</li>
<li>transforms_train.json</li>
<li>transforms_val.json</li>
</ul>
</li>
</ul>
</blockquote>
</li>
<li>half_res，是否将图像缩小一倍 （下采样）</li>
<li>testskip，测试集跳着读取图像<br>输出： </li>
<li>imgs：train、val、test，三个集的图像数据   imgs.shape : (400, 800, 800, 4)</li>
<li>poses：相机外参矩阵，相机位姿 poses.shape : (400, 4, 4)  400张图片的4x4相机外参矩阵</li>
<li>render_poses：渲染位姿，生成视频的相机位姿（torch.Size([40, 4, 4])：40帧）</li>
<li>[H, W, focal] 图片数据，高、宽、焦距</li>
<li>i_split，三个array数组<ol>
<li>0,1,2,…,99 （100张train图像）</li>
<li>100,101,…,199 （100张val图像）</li>
<li>200,201,…399 （200张test图像）</li>
</ol>
</li>
</ul>
<h1 id="create-nerf-args"><a href="#create-nerf-args" class="headerlink" title="create_nerf(args)"></a>create_nerf(args)</h1><p>输入：</p>
<ul>
<li>args，由命令行和默认设置的arguments共同组成的字典<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">parser = config_parser()</span><br><span class="line">args = parser.parse_args()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>输出：</p>
<ul>
<li>render_kwargs_train</li>
<li>render_kwargs_test<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">render_kwargs_train = &#123;</span><br><span class="line">    &#x27;network_query_fn&#x27; : network_query_fn,</span><br><span class="line">    &#x27;perturb&#x27; : args.perturb, # 默认为1 --perturb：在训练时对输入进行扰动</span><br><span class="line">    &#x27;N_importance&#x27; : args.N_importance, # --N_importance：每条射线的附加精细采样数</span><br><span class="line">    &#x27;network_fine&#x27; : model_fine,</span><br><span class="line">    &#x27;N_samples&#x27; : args.N_samples, # --N_samples：每条射线的粗略采样数</span><br><span class="line">    &#x27;network_fn&#x27; : model,</span><br><span class="line">    &#x27;use_viewdirs&#x27; : args.use_viewdirs, # --use_viewdirs：使用全5D的输入代替3D的输入</span><br><span class="line">    &#x27;white_bkgd&#x27; : args.white_bkgd,</span><br><span class="line">    &#x27;raw_noise_std&#x27; : args.raw_noise_std, # 默认0 --raw_noise_std：添加到输入的噪声标准差</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># NDC only good for LLFF-style forward facing data</span><br><span class="line"># NDC 全称是 Normalized Device Coordinates，即归一化设备坐标</span><br><span class="line">if args.dataset_type != &#x27;llff&#x27; or args.no_ndc:</span><br><span class="line">    print(&#x27;Not ndc!&#x27;)</span><br><span class="line">    render_kwargs_train[&#x27;ndc&#x27;] = False</span><br><span class="line">    render_kwargs_train[&#x27;lindisp&#x27;] = args.lindisp</span><br><span class="line">    </span><br><span class="line">render_kwargs_test = &#123;k : render_kwargs_train[k] for k in render_kwargs_train&#125;</span><br><span class="line">render_kwargs_test[&#x27;perturb&#x27;] = False</span><br><span class="line">render_kwargs_test[&#x27;raw_noise_std&#x27;] = 0.</span><br></pre></td></tr></table></figure></li>
<li>start ：global step</li>
<li>grad_vars：model的参数列表，包括权重和偏置<ul>
<li><code>grad_vars = list(model.parameters())</code></li>
<li>if args.N_importance &gt; 0: <code>grad_vars += list(model_fine.parameters())</code></li>
</ul>
</li>
<li>optimizer<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">optimizer = torch.optim.Adam(params=grad_vars, lr=args.lrate, betas=(0.9, 0.999))</span><br><span class="line"></span><br><span class="line">if 加载了ckpt ：  optimizer.load_state_dict(ckpt[&#x27;optimizer_state_dict&#x27;])</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="get-embedder-args-multires-args-i-embed"><a href="#get-embedder-args-multires-args-i-embed" class="headerlink" title="get_embedder(args.multires, args.i_embed)"></a>get_embedder(args.multires, args.i_embed)</h2><p>输入：</p>
<ul>
<li>args.multires, 输入的L</li>
<li>args.i_embed，默认为0，使用位置编码，-1为无位置编码</li>
</ul>
<p>输出：</p>
<ul>
<li>embed, 位置编码函数，<code>将(1024 * 32 * 64) * 3处理为 (1024 * 32 * 64) * 63</code><ul>
<li>input_ch = 3 , L = 10 并且包括输入维度</li>
</ul>
</li>
<li>embedder_obj.out_dim : 输出的维度</li>
</ul>
<h3 id="Embedder"><a href="#Embedder" class="headerlink" title="Embedder()"></a>Embedder()</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class Embedder:</span><br><span class="line">    def __init__(self, **kwargs):</span><br><span class="line">        self.kwargs = kwargs</span><br><span class="line">        self.create_embedding_fn()</span><br><span class="line">    def create_embedding_fn(self):  </span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h2 id="NeRF-nn-Module"><a href="#NeRF-nn-Module" class="headerlink" title="NeRF(nn.Module)"></a>NeRF(nn.Module)</h2><p>继承nn.Module构建的类</p>
<p>def <strong>init</strong>(self, D=8, W=256, input_ch=3, input_ch_views=3, output_ch=4, skips=[4], use_viewdirs=False)</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/357021687">Pytorch 中的 forward理解 - 知乎 (zhihu.com)</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model = NeRF(...) 实例化</span><br><span class="line">model(input) 相当于 model.forward(input)</span><br></pre></td></tr></table></figure>
<ul>
<li>D=args.netdepth, W=args.netwidth</li>
<li>input_ch=input_ch, output_ch=output_ch</li>
<li>skips=skips,</li>
<li>input_ch_views=input_ch_views</li>
<li>use_viewdirs=args.use_viewdirs</li>
</ul>
<h2 id="network-query-fn"><a href="#network-query-fn" class="headerlink" title="network_query_fn"></a>network_query_fn</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">network_query_fn = lambda inputs, viewdirs, network_fn : run_network(inputs, viewdirs, network_fn,</span><br><span class="line">    embed_fn=embed_fn,</span><br><span class="line">    embeddirs_fn=embeddirs_fn,</span><br><span class="line">    netchunk=args.netchunk)</span><br></pre></td></tr></table></figure>
<h1 id="if-render-only"><a href="#if-render-only" class="headerlink" title="if render_only:"></a>if render_only:</h1><h2 id="render-path"><a href="#render-path" class="headerlink" title="render_path()"></a>render_path()</h2><p>输入：</p>
<ul>
<li>render_poses, 测试集的渲染相机位姿  200 <em> 4 </em> 4 </li>
<li>hwf, </li>
<li>K, 相机内参矩阵</li>
<li>chunk, <code>args.chunk=1024*32</code></li>
<li>render_kwargs = render_kwargs_test</li>
<li>gt_imgs=None, </li>
<li>savedir=None, </li>
<li>render_factor=0</li>
</ul>
<p>输出：</p>
<ul>
<li>rgbs, 200 x W x H x 3</li>
<li>disps，200xWxH</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">render_path(render_poses, hwf, K, args.chunk, render_kwargs_test, gt_imgs=images, savedir=testsavedir, render_factor=args.render_factor)</span><br></pre></td></tr></table></figure>
<h3 id="render"><a href="#render" class="headerlink" title="render()"></a>render()</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rgb, disp, acc, _ = render(H, W, K, chunk=chunk, c2w=c2w[:3,:4], **render_kwargs)</span><br></pre></td></tr></table></figure>
<h1 id="get-rays-np-H-W-K-c2w-numpy版本-narray"><a href="#get-rays-np-H-W-K-c2w-numpy版本-narray" class="headerlink" title="get_rays_np(H, W, K, c2w) numpy版本(narray)"></a>get_rays_np(H, W, K, c2w) numpy版本(narray)</h1><p>通过输入的图片大小和相机参数，得到从相机原点到图片每个像素的光线（方向向量d和相机原点o）</p>
<p>输入：</p>
<ul>
<li>H：图片的高</li>
<li>W：图片的宽</li>
<li>K：相机内参矩阵<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">K = np.array([</span><br><span class="line">    [focal, 0, 0.5*W],</span><br><span class="line">    [0, focal, 0.5*H],</span><br><span class="line">    [0, 0, 1]</span><br><span class="line">])</span><br></pre></td></tr></table></figure></li>
<li>c2w：相机外参矩阵<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c2w = np.array([</span><br><span class="line">            [ -0.9980267286300659,  0.04609514772891998,  -0.042636688798666, -0.17187398672103882],</span><br><span class="line">            [ -0.06279052048921585,  -0.7326614260673523, 0.6776907444000244, 2.731858730316162],</span><br><span class="line">            [-3.7252898543727042e-09, 0.6790306568145752,0.7341099381446838, 2.959291696548462],</span><br><span class="line">            [ 0.0,0.0,0.0,1.0 ]])</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>输出：从相机原点到800x800图片中每个像素生成的光线 $r(t)=\textbf{o}+t\textbf{d}$</p>
<ul>
<li>rays_o：光线原点（世界坐标系下）(800, 800, 3)</li>
<li>rays_d：光线的方向向量（世界坐标系下）(800, 800, 3)</li>
</ul>
<p>需要对render输入的光线做batch: <code>rays = batch_rays</code></p>
<h1 id="render-1"><a href="#render-1" class="headerlink" title="render()"></a>render()</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(H, W, K, chunk=1024*32, rays=None, c2w=None, ndc=True,near=0., far=1.,use_viewdirs=False, c2w_staticcam=None, **kwargs)</span><br></pre></td></tr></table></figure>
<p>输入</p>
<ul>
<li>H</li>
<li>W</li>
<li>K</li>
<li>chunk=args.chunk 同时处理光线的最大数量</li>
<li>rays=batch_rays  <code>[2, batch_size, 3]</code> </li>
<li>verbose=i &lt; 10   </li>
<li>retraw=True</li>
<li>render_kwargs_train</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">render_kwargs_train = &#123;</span><br><span class="line">    &#x27;network_query_fn&#x27; : network_query_fn,</span><br><span class="line">    &#x27;perturb&#x27; : args.perturb, # 默认为1 --perturb：在训练时对输入进行扰动，是否分层采样</span><br><span class="line">    &#x27;N_importance&#x27; : args.N_importance, # --N_importance：每条射线的附加精细采样数 = 128</span><br><span class="line">    &#x27;network_fine&#x27; : model_fine,</span><br><span class="line">    &#x27;N_samples&#x27; : args.N_samples, # --N_samples：每条射线的粗略采样数 64</span><br><span class="line">    &#x27;network_fn&#x27; : model,</span><br><span class="line">    &#x27;use_viewdirs&#x27; : args.use_viewdirs, # --use_viewdirs：使用全5D的输入代替3D的输入</span><br><span class="line">    &#x27;white_bkgd&#x27; : args.white_bkgd,</span><br><span class="line">    &#x27;raw_noise_std&#x27; : args.raw_noise_std, # 默认0 --raw_noise_std：添加到输入的噪声标准差</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：<code>ret_list + [ret_dict]</code></p>
<ul>
<li>rgb: <code>all_ret[&#39;rgb_map&#39;]</code> </li>
<li>disp: <code>all_ret[&#39;disp_map&#39;]</code></li>
<li>acc: <code>all_ret[&#39;acc_map&#39;]</code></li>
<li>extras: <code>[&#123;&#39;raw&#39;: raw , &#39;...&#39;: ...&#125;]</code><br>eg:  <code>all_ret[&#39;raw&#39;] : W * H * N_samples +N_importance * 4</code><br>eg: <code>all_ret[&#39;rgb_map&#39;] : W * H * 3</code></li>
</ul>
<h2 id="渲染流程图"><a href="#渲染流程图" class="headerlink" title="渲染流程图"></a>渲染流程图</h2><iframe frameborder="0" style="width:100%;height:1583px;" src="https://viewer.diagrams.net/?highlight=0000ff&edit=_blank&layers=1&nav=1&title=render%E6%B5%81%E7%A8%8B.drawio#R7R1bc6O2%2Btcwm3QmHu7gR1%2BS3Zme7mm7Z7qnTx5sY5uzGFzAcbK%2F%2FkhCAiR9tnECNkncmW6MJJD47jcJxRitnz4n3mb1Wzz3Q0VX50%2BKMVZ0XTMNFf3BLc95i62becMyCeZ0UNnwLfjp00Z633IbzP2UG5jFcZgFG75xFkeRP8u4Ni9J4h0%2FbBGH%2FKwbb%2BlLDd9mXii3fg%2Fm2SpvdXWnbP%2FiB8sVm1mz%2B3nP2mOD6ZukK28e7ypNxr1ijJI4zvJf66eRH2LgMbjk9z3s6S0WlvhRVucG77P%2FFD5Gz9%2F%2BUhePm1%2FT2V9L444uNs2e2Qv7c%2FT%2B9DJOslW8jCMvvC9bh0m8jeY%2BfqqKrsox%2F4rjDWrUUOP%2F%2FCx7psj0tlmMmlbZOqS9%2FlOQ%2FRff3rPo1d%2BVnvETfTK5eGYXUZY8V27Cl39X%2B8rbyBW7bxFHGV2IZqBrGWoUkGm8TWb%2BAVAx6vOSpZ8dGKfn4zAcKxNQnHz247WP1ocGJH7oZcEjT2ceJddlMa7EKPpBkXoCgulzH71wS2dae0GEWkKMLXQz%2Fp0lpE2ghBLPGDW7VZD53zYegdEOMTuP09pwfvSTzH86CBnaa1mUc54Zb9HrXcmIRduqwoSm2hIwzUtyi1bhlZJzjnELxysl67TOLXpNbjE6xS26xC3ozed%2B0n3ecC%2FNG%2FZVk9TlDaMmb1id4g1D4g20%2BkniPaed4w5HFbnDkrjDAZjDaIs5GCdeiDtepDkuxR1WTe5wO8UdlsQd0Xz2Nrij0AkX4w7jqjvqcodbkzs07VLssXncjf%2F8t7P68vB898fU%2FPEzjfw747KO5tkRPPfSVcHijWIbBK9pNo1tcusgQQKsMmATB1GWVp78O24oJYvLCxZDjEgcHq6Z%2FcPjbdU6eAP6ka%2B4pNPi1V8unVxJsk%2B9bLYKFs%2FdFO%2Bia6Bf3DXQLuo3vy35rtUNM2kXizOBEkh337eA5wR6u%2BiG4eu0IuElGWsYYtBNE8RCvlR6W0k1p%2BoKXZjIOCL8xfHFwmprC%2BGGdrQFQ6gUQnobysKwLq4snKuyqC096kZZtW6FkswLO3x6%2B0huS1%2FUxXhLHsFRKevq7agLy3G4eUz3sPQ3hCDHqeMdxzpJuwjjW1IuuqRcIj%2FbxcmPyT9bP3meLCJFt0NEF8NpwvGX%2Fc8W55kJJd6lhBQHaIBmbJ4IPbJ%2B9GtJ%2FuKb1GQbTegEnddcpn5xzXVZE%2Fhtaa66UV7NbkWOnSp%2BHINnd8s8zfgUxrckHuQgtL%2Be%2BnMiFjrGvnZfAJAqs68LcG9rQWj9GoSuz712Te7VLxakOLhuIJaHWpV7S3FdxbWVe1tx%2B8qwr9ybyhC1qLhlMFIG2iK6ma220Y9f0HjbuMW3DExl4OAfQ1VxHzrHaEzyFIxmA3rSADjNao3TNAlIXS%2Bj0Tg%2BO1pG05Lxzyyct%2BbusXULpQNEN3WxuMZ2nR6vnUxNLiBgCqxp7QTnz67lNfXZ5HI%2B8uvYRPbusOGmkp8qc%2FQqTWtabZ1fffX%2FfLjp9Xq3neMny%2BS5yTZkbtL0s6qgy7LTG1ZBdf22jll%2BuuwaYX7pHKuIbpFtyqxyXrfo3Qc12uIUpy6ndMxYcyROmSW%2Bl%2FmTyE8WnWcYC6h2OCvDGLKxe%2FMdXWOP8cst%2FYGYSo1xhFbuwgnERkK4AUKWuk39yWPg7%2BZBIicfEYgzHkFplsQ%2F%2FFEcosUZ4yiOMDcvgjAUmrwwWEbocoYQhwx4Y4gRFsy8cEA71sF8TkQBRBG8eGiBKAyhskiHspo2QBVi8qI5qpDTwnkgQaYIrlmTfeUPgzUwFw0VpraHNbnmnQSJLGVo09jQYIwxRy%2BGmCFxnn%2BC9NnYwB36iDXN86YRseW9hOCODViw6w%2BDa0fg0D6A6%2F5ZcW1KuA6izRYnBdRc0vKc%2BXWSeutN6KN%2BG%2F1AYImmKf6DOw2xkWD6ZLEuyfRSlNM1kSXRFckB7PdLPjWSfzqU%2FGuPfGQHAyQfkXpuS%2BS9njyIypdo5OjECCbDj0U%2Fpi3QDyB%2BikTxeehHTk3Q%2BOi8JiLtRkjoRqShbOUjfA1um3g4%2F0aHX4dh5COQo1h8YgGWjw7laNojR7nqfQ85vor8IL%2BlSQqEng8R4YckOiExaOtAVPa8JlhfIro7dHmE8MzOiz35JaQ3eBNEh6%2FZdAoWWv2%2BqjZEjEJ1tw1tWmmLGOEtVRJSup6kLi7OfdYDy6Md3cRwscMe4NVcK82bR3Hz%2B1ReV2kue%2FWJt9PjbZb7Zh2LZotFra4D6OTzHnkj%2ByVmruuQQhwt0f9THMIaPSjuB%2FIfLcFgdw1ZXZ3VdDJlex3RuQKFiQ4Grhoxpn5O0DLSwzO%2FehIaU70GwgSBAXiO6jkFhiVnOrD9myynkzWCCQl3K7aqWEOKshHBmDXGjbguw9BUajPPg3RDbsIYluOplYdAd3uzWXHz0cE7AppUHkyWVxIuuEx%2Fk60OTgVT44nqpU3rW4jG96G9FJA8c9uyvuXEy9dJsN4ge8uLELwkvb2K19NtehGd7aj8ziTXAnQ2yySdBXjX81RAwxaEFVDPBMNUv5Rde2jZFf7IJdRkM%2B9ejYajuUI9bf%2BcZ1KAAJTN2r%2F9Q%2F6AykMJYAWQZURo%2BtF8gE%2BlRdfTMJ79yJseArx4SufsEFy3sFLYwbPEbmGnyOLBoTf1w6E3%2B7EkCxVMl%2BM8f06WfTmLAsflHeKJoxxKqVLtaRorr6BkeccOJ37pplg2JF4sUp%2Fb7yrvKBN1rkjqOVykjbPHH%2BSqPVXVLNNy%2B4aj9V3%2BsXv2475gDxqIBNkPyb2BCbKTQWO9mbQVs9%2BsYa%2FXQ0YbouHBnYbtLzonbz4KqQu9iSUcNFDerQPiuJJsB6q7dR2wf2yrJdkOpxF4T%2FTN4apF87%2FYs89OSlGBzZit1cvB5pZ1NWHr6kfoTAh44MX2uxxc9%2FU0A8hE1lTgWM7z2sja2wqeOxrviCNgXRyCspuxXw3RMqxKlPSjRTNdTVREQFz9zIpI3g5x2JjYg8Vrjh%2BZGbKMg8LVJmArtoffN%2FMFlAbPn6%2B7j5wN7IjBYF6NwtpGIbT97ExHB7%2FuHFFZ3mZxMlv1Zl7GDtkgB3QMHvBpG3QTxiCXx%2FjcjqEyHJEf98rAUu5dZYhucnBLf4xbuma1SF%2FyADcrndVqAbawJTiapeZ2tOIMP9F03qcipMPl9z6xzF3ZX%2BTy8gE0OVf2s2ydM27K5qePmQePr3oOKQxEr4%2FT6SSQFOa9D%2BTBzc4F7xoRmzAuLIQCb%2FeJBbiIe4Pz%2FeLgQ6tNN14ELhdbJnfUyCDhOmZnKPgDas2AX5wj9BfZy2bY%2Bxr1H2Qw8B0ulyhMO87e48omEKTz9fBrhBGwZ3ADVNQMYAjpS9YtJTE6laryXFH%2F7c%2FLLMupynNLLq8maocWiWUkv0omNTu1TCSq%2BVVS2d2pRf6cpNmcW2VuRqDWm58lS48IkNdoBP5SHr7aRtPAS4lB8OCFqX8LTkt2TVnDr%2FmpztZ435vDPt%2F5rQxN9KyL81YqVoYJ7Xgq3O3mzQy5yIPU7YThpNvmxl6J%2B6p6NvpG%2BQ6H7798aXRnYCMrlO2O6lpfpHaOMnljKrgJ6J1qMenqfpOmEYO1FTyfaLQ0IuJaDDtp4mdmoL3mJrS7rt%2Ba5JMD63JQ8Ro%2FFDftCp6yA50ZYAF4bC14CGz6PqXWtQk392V1sk3NfLTGtqmJjtXnihF4uWK3MWC%2F%2BWrf4uPlhS0IbTeGDk1qrWLVBL6astcfr%2BJ6CMjJRlC9fw%2FDvukbmfa6qyGnM9FbATK5hq71gCNYW4uKQlvJ%2FGwSBimp%2FIsw1nDDPJhl3Y8yW1Bm9axRZmBn2VE7e5aTMfUAb%2BjpSezPbcXaXnjrIHzOh6788NHH5L3fGq905JPinihO1l5Y6dtRuOBOk4pjNfQzxEN3aM2zIFrKd%2B6PdJKeANFFRJ%2BpspWQnizxonSBnsSeSVgXoyxO5vx8xY3Tohj4ToCVjreIYTDpZp%2F%2BsBjEsAERehRaQRQGbKZFGHuZML0osgp%2FvU3%2FoAnzUfQDoE8OQLUFrR3qbF0492zatlLJaPZUU1fa3mluHbBt8GS%2F%2B0mAoIuV0ivLxs26GVDrYl%2BSPrhuQC42lRnA4zF3ezP%2BOaWgrNz6SnsZyZ7CUmaiwqpE9Dj7HAEsX9uZEghnhwaWtBA4ygjmx4IHciAhcBTx2o8FDaQaE49zcknwGwdccz2e%2B0R5TLvX69FmvOXBGfNZiDqA6rqjaji2WDAGmq3QztTWshbATnuBVF4Ydv2S4%2FV7%2FufX%2FM9M3%2B1F6qvRZzWDJvbpuwJJ0BdmINeiNcPKlHeANIMjotDy813vH3ChUX9wQxFG0WdwJ0YJd82P39UOlltkUnH7mQZF16ETCJr4uANsz8nlS21w6CKeIRevPM%2B3POk35k79fWvsqwMiVofC6u35RXI0sHH2PcSkUp8YVb%2F5Oh7hYsT%2BWOnn3wZTFddR7h1laCjDIfts2PD9cDVYlNjWJ1tgopDDb0fDRVIkqEAkApdhClYc36PsS96amLK4PilixHWLQSP9eNyIDTmSVgbjR1wnFEJiA%2BAoEus9EkhSK7EktRJOYrdDEaUCKkJQ6ZjpPStIvBxo4P8WC%2FneMiCfIxzzpK70EXP2MYu6DmXXIWHX%2FkBxTVIbTCqL6ZiHI3Y0JxhesdJKJqG62OE9tNhW10hFh4wJXHHtKgMb3XhHV0hhxg68x%2Bfho2WPKyssxrj4XfoGGzM4ec3NBxObUpoarzSh8yygTxU4rYlH4PzxeuWbUsb4o2SZbGHbswvpuLPWE1j7fcsTUiJlVqRMjHAaqWmNaFxOI5JkynvXh%2F9ZBTi9Tf7xwjRWyPHE6N9iJ64a57sU0LsnN7ftSc%2FGjk80xMCODXkdDQUN0GUSY4gWfZ%2FRW65%2BI59PNO7%2FDw%3D%3D"></iframe>


<h2 id="get-rays-H-W-K-c2w-torch版本-tensor"><a href="#get-rays-H-W-K-c2w-torch版本-tensor" class="headerlink" title="get_rays(H, W, K, c2w) torch版本(tensor)"></a>get_rays(H, W, K, c2w) torch版本(tensor)</h2><p>通过输入的图片大小和相机参数，得到从相机原点到图片每个像素的光线（方向向量d和相机原点o）</p>
<p>输入：</p>
<ul>
<li>H：图片的高</li>
<li>W：图片的宽</li>
<li>K：相机内参矩阵<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">K = np.array([</span><br><span class="line">    [focal, 0, 0.5*W],</span><br><span class="line">    [0, focal, 0.5*H],</span><br><span class="line">    [0, 0, 1]</span><br><span class="line">])</span><br></pre></td></tr></table></figure></li>
<li>c2w：相机外参矩阵<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c2w = np.array([</span><br><span class="line">            [ -0.9980267286300659,  0.04609514772891998,  -0.042636688798666, -0.17187398672103882],</span><br><span class="line">            [ -0.06279052048921585,  -0.7326614260673523, 0.6776907444000244, 2.731858730316162],</span><br><span class="line">            [-3.7252898543727042e-09, 0.6790306568145752,0.7341099381446838, 2.959291696548462],</span><br><span class="line">            [ 0.0,0.0,0.0,1.0 ]])</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>输出：从相机原点到800x800图片中每个像素生成的光线 $r(t)=\textbf{o}+t\textbf{d}$</p>
<ul>
<li>rays_o：光线原点（世界坐标系下）(800, 800, 3)</li>
<li>rays_d：光线的方向向量（世界坐标系下）(800, 800, 3)</li>
</ul>
<h2 id="ndc-rays-H-W-focal-near-rays-o-rays-d"><a href="#ndc-rays-H-W-focal-near-rays-o-rays-d" class="headerlink" title="ndc_rays(H, W, focal, near, rays_o, rays_d)"></a>ndc_rays(H, W, focal, near, rays_o, rays_d)</h2><p>仅需要对LLFF做Projection 变换到NDC坐标系下</p>
<p>输入：</p>
<ul>
<li>H</li>
<li>W</li>
<li>focal</li>
<li>near</li>
<li>rays_o</li>
<li>rays_d</li>
</ul>
<p>输出：NDC坐标系下</p>
<ul>
<li>rays_o</li>
<li>rays_d</li>
</ul>
<h2 id="batchify-rays-rays-flat-chunk-1024-32-kwargs"><a href="#batchify-rays-rays-flat-chunk-1024-32-kwargs" class="headerlink" title="batchify_rays(rays_flat, chunk=1024*32, **kwargs)"></a>batchify_rays(rays_flat, chunk=1024*32, **kwargs)</h2><p>输入：</p>
<ul>
<li>rays_flat: (WxH)x8 or (WxH)x11</li>
<li>chunk=1024*32</li>
<li>**kwargs</li>
</ul>
<p>输出：</p>
<ul>
<li>all_ret: 将ret = {‘rgb_map’ : rgb_map, ‘disp_map’ : disp_map, ‘acc_map’ : acc_map} 拼接起来</li>
</ul>
<p><strong>ret：chunk(1024 * 32) —&gt; all_ret：800x800</strong></p>
<h3 id="render-rays"><a href="#render-rays" class="headerlink" title="render_rays()"></a>render_rays()</h3><p>输入：</p>
<ul>
<li>ray_batch</li>
<li>继承来自render()输入的参数：</li>
<li>network_fn,</li>
<li>network_query_fn,</li>
<li>N_samples,</li>
<li>retraw=False,</li>
<li>lindisp=False,</li>
<li>perturb=0.,</li>
<li>N_importance=0, 每条光线增加的采样数</li>
<li>network_fine=None,</li>
<li>white_bkgd=False,</li>
<li>raw_noise_std=0.,</li>
<li>verbose=False,</li>
<li>pytest=False</li>
</ul>
<p>输出：<br>ret = {‘rgb_map’ : rgb_map, ‘disp_map’ : disp_map, ‘acc_map’ : acc_map}<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">if retraw:</span><br><span class="line">    ret[&#x27;raw&#x27;] = raw</span><br><span class="line"></span><br><span class="line">if N_importance &gt; 0:</span><br><span class="line">    ret[&#x27;rgb0&#x27;] = rgb_map_0</span><br><span class="line">    ret[&#x27;disp0&#x27;] = disp_map_0</span><br><span class="line">    ret[&#x27;acc0&#x27;] = acc_map_0</span><br><span class="line">    ret[&#x27;z_std&#x27;] = torch.std(z_samples, dim=-1, unbiased=False)  # [N_rays]</span><br></pre></td></tr></table></figure></p>
<h4 id="run-network-inputs-viewdirs-fn-embed-fn-embeddirs-fn-netchunk-1024-64"><a href="#run-network-inputs-viewdirs-fn-embed-fn-embeddirs-fn-netchunk-1024-64" class="headerlink" title="run_network(inputs, viewdirs, fn, embed_fn, embeddirs_fn, netchunk=1024*64)"></a>run_network(inputs, viewdirs, fn, embed_fn, embeddirs_fn, netchunk=1024*64)</h4><p>输入：</p>
<ul>
<li>inputs </li>
<li>viewdirs</li>
<li>fn：network_fn = model ，经过一次MLP训练</li>
<li>embed_fn</li>
<li>embeddirs_fn</li>
<li>netchunk=1024*64</li>
</ul>
<p>输出：</p>
<ul>
<li>outputs: chunk <em> N_samples </em> 4 (每条光线，每个采样点的RGBσ)</li>
</ul>
<p>在这里调用了run_network函数<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    network_query_fn = lambda inputs, viewdirs, network_fn : run_network(inputs, viewdirs, network_fn,</span><br><span class="line">                                                                embed_fn=embed_fn,</span><br><span class="line">                                                                embeddirs_fn=embeddirs_fn,</span><br><span class="line">                                                                netchunk=args.netchunk)</span><br></pre></td></tr></table></figure></p>
<h5 id="batchify-fn-chunk"><a href="#batchify-fn-chunk" class="headerlink" title="batchify(fn, chunk)"></a>batchify(fn, chunk)</h5><p>输入：</p>
<ul>
<li>fn : model</li>
<li>chunk : 1024* 32 </li>
</ul>
<p>如果chunk没有数据，则返回fn，否则：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def ret(inputs):</span><br><span class="line">    return torch.cat([fn(inputs[i:i+chunk]) for i in range(0, inputs.shape[0], chunk)], 0)</span><br><span class="line">            # 每个chunk的大小为1024*32，即每次fn处理1024*32个点，最后返回结果</span><br></pre></td></tr></table></figure></p>
<h4 id="raw2outputs-raw-z-vals-rays-d-raw-noise-std-0-white-bkgd-False-pytest-False"><a href="#raw2outputs-raw-z-vals-rays-d-raw-noise-std-0-white-bkgd-False-pytest-False" class="headerlink" title="raw2outputs(raw, z_vals, rays_d, raw_noise_std=0, white_bkgd=False, pytest=False)"></a>raw2outputs(raw, z_vals, rays_d, raw_noise_std=0, white_bkgd=False, pytest=False)</h4><p>体渲染在其中<br>chunk = N_rays，射线数<br>输入：</p>
<ul>
<li>raw: chunk <em> N_samples </em> 4</li>
<li>z_vals: chunk * N_samples</li>
<li>rays_d: chunk * 3</li>
<li>raw_noise_std=0, </li>
<li>white_bkgd=False, </li>
<li>pytest=False)</li>
</ul>
<p>输出：</p>
<ul>
<li>rgb_map, <code>[chunk, 3]</code></li>
<li>disp_map:  <code>[chunk]</code></li>
<li>acc_map: <code>[chunk]</code></li>
<li>weights: <code>[chunk, N_samples]</code></li>
<li>depth_map: <code>[chunk]</code></li>
</ul>
<h4 id="sample-pdf-bins-weights-N-samples-det-False-pytest-False"><a href="#sample-pdf-bins-weights-N-samples-det-False-pytest-False" class="headerlink" title="sample_pdf(bins, weights, N_samples, det=False, pytest=False)"></a>sample_pdf(bins, weights, N_samples, det=False, pytest=False)</h4><p>输入：</p>
<ul>
<li>bins, chunk * 63</li>
<li>weights, chunk * 62</li>
<li>N_samples = N_importance</li>
<li>det=False  = (perturb\==0.)</li>
<li>pytest=False</li>
</ul>
<p><img src="https://raw.githubusercontent.com/yq010105/Blog_images/main/pictures/20230618145142.png" alt="image.png|555"></p>
<p>输出：</p>
<ul>
<li>samples:  chunk * N_importance</li>
</ul>
<h1 id="img2mse-and-mse2psnr"><a href="#img2mse-and-mse2psnr" class="headerlink" title="img2mse() and mse2psnr()"></a>img2mse() and mse2psnr()</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">img2mse = lambda x, y : torch.mean((x - y) ** 2)</span><br><span class="line">mse2psnr = lambda x : -10. * torch.log(x) / torch.log(torch.Tensor([10.]))</span><br></pre></td></tr></table></figure>
<p> 数学公式： </p>
<p> $\text{MSE}(x, y) = \frac{1}{N}\sum_{i=1}^{N}(x_i - y_i)^2$</p>
<p> $\text{PSNR}(x) = -10 \cdot \frac{\ln(x)}{\ln(10)}$</p>

    </div>

    
    
    
        

  <div class="followme">
    <p>Welcome to my other publishing channels</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/+1ZnNxFWnEbk5YzRl">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/NeRF/" rel="tag"><i class="fa fa-tag"></i> NeRF</a>
              <a href="/tags/Python/" rel="tag"><i class="fa fa-tag"></i> Python</a>
              <a href="/tags/Code/" rel="tag"><i class="fa fa-tag"></i> Code</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/3DReconstruction/Multi-view/Implicit%20Function/NeRF-based/NeRF%20Other%20Research/NeRF-Studio/" rel="prev" title="Nerfstudio——简化NeRF流程">
      <i class="fa fa-chevron-left"></i> Nerfstudio——简化NeRF流程
    </a></div>
      <div class="post-nav-item">
    <a href="/Project/Python%20Scripts/" rel="next" title="Python Scripts">
      Python Scripts <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#train%E6%B5%81%E7%A8%8B"><span class="nav-text">train流程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#if-use-batching"><span class="nav-text">if use_batching</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#config-parser"><span class="nav-text">config_parser()</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#load-data"><span class="nav-text">load_???_data()</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#load-llff-data"><span class="nav-text">load_llff_data()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#load-blender-data-basedir-half-res-False-testskip-1"><span class="nav-text">load_blender_data(basedir, half_res&#x3D;False, testskip&#x3D;1)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#create-nerf-args"><span class="nav-text">create_nerf(args)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#get-embedder-args-multires-args-i-embed"><span class="nav-text">get_embedder(args.multires, args.i_embed)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Embedder"><span class="nav-text">Embedder()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NeRF-nn-Module"><span class="nav-text">NeRF(nn.Module)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#network-query-fn"><span class="nav-text">network_query_fn</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#if-render-only"><span class="nav-text">if render_only:</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#render-path"><span class="nav-text">render_path()</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#render"><span class="nav-text">render()</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#get-rays-np-H-W-K-c2w-numpy%E7%89%88%E6%9C%AC-narray"><span class="nav-text">get_rays_np(H, W, K, c2w) numpy版本(narray)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#render-1"><span class="nav-text">render()</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="nav-text">渲染流程图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#get-rays-H-W-K-c2w-torch%E7%89%88%E6%9C%AC-tensor"><span class="nav-text">get_rays(H, W, K, c2w) torch版本(tensor)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ndc-rays-H-W-focal-near-rays-o-rays-d"><span class="nav-text">ndc_rays(H, W, focal, near, rays_o, rays_d)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#batchify-rays-rays-flat-chunk-1024-32-kwargs"><span class="nav-text">batchify_rays(rays_flat, chunk&#x3D;1024*32, **kwargs)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#render-rays"><span class="nav-text">render_rays()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#run-network-inputs-viewdirs-fn-embed-fn-embeddirs-fn-netchunk-1024-64"><span class="nav-text">run_network(inputs, viewdirs, fn, embed_fn, embeddirs_fn, netchunk&#x3D;1024*64)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#batchify-fn-chunk"><span class="nav-text">batchify(fn, chunk)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#raw2outputs-raw-z-vals-rays-d-raw-noise-std-0-white-bkgd-False-pytest-False"><span class="nav-text">raw2outputs(raw, z_vals, rays_d, raw_noise_std&#x3D;0, white_bkgd&#x3D;False, pytest&#x3D;False)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sample-pdf-bins-weights-N-samples-det-False-pytest-False"><span class="nav-text">sample_pdf(bins, weights, N_samples, det&#x3D;False, pytest&#x3D;False)</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#img2mse-and-mse2psnr"><span class="nav-text">img2mse() and mse2psnr()</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Qi Yun"
      src="/images/avatar.jpeg">
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">164</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">60</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/qiyun71" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;qiyun71" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/29010355" title="Bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;29010355" rel="noopener" target="_blank"><i class="fa fa-star fa-fw"></i>Bilibili</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2020 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Qi Yun</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">553k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">33:29</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/yqq/anime.min.js"></script>
  <script src="/yqq/velocity/velocity.min.js"></script>
  <script src="/yqq/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="//cdn.jsdelivr.net/gh/theme-next/theme-next-three@1/three.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
